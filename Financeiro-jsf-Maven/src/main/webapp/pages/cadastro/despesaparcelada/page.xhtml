<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:arq="http://java.sun.com/jsf/composite/ezcomp"
                template="../../../templates/layout.xhtml"
                >

    <ui:define name="content">
        <h:form id="formDespesaParceladaTable">
            <h:panelGroup >
                <table class="referencesmall" width="100%">
                    <thead style="font-size: 0.9em;"><tr>
                            <th align='center'>
                                <h:outputText value="#{msg.vencimento}" />
                            </th>
                            <th align='center' width="60"><h:outputText value="#{msg.valor}"/></th>
                            <th align='center'><h:outputText value="#{msg.atual}"/></th>
                            <th align='center'><h:outputText value="#{msg.total}"/></th>
                            <th align='center'>
                                <h:outputText value="#{msg.observacao}"/><br></br>
                                <h:inputText value="#{despesaParceladaController.observacaoFiltro}" styleClass="selectTableFilter" id="search"
                                             title="#{msg.tipoBuscaInicia}">
                                    <p:ajax event="blur" listener="#{despesaParceladaController.recreateTable()}" update="formDespesaParceladaTable"/>
                                </h:inputText>
                            </th>
                            <th align='center'><h:outputText value="#{msg.detalhe}"/></th>
                            <th align='center'>
                                <h:outputText value="#{msg.status}"/><br></br>
                                <p:selectOneMenu value="#{despesaParceladaController.statusFiltro}" id="statusFiltro" style="font-size: 0.9em;">
                                    <p:ajax listener="#{despesaParceladaController.recreateTable()}" update="formDespesaParceladaTable"/>
                                    <f:selectItem itemLabel="#{msg.todos}" itemValue="#{null}"/>
                                    <f:selectItems value="#{despesaParceladaController.status}"/>
                                </p:selectOneMenu>
                            </th>
                            <th align='center'><h:outputText value="#{msg.cartaoCredito}"/></th>
                            <th align='center'>
                                <h:outputText value="#{msg.responsavel}"/><br></br>
                            </th>
                            <th width="150" class="ac"></th>
                        </tr></thead>
                    <tbody>
                        <ui:repeat value="#{despesaParceladaController.items}" var="item" varStatus="x">
                            <tr >
                                <td align='center'>
                                    <h:outputText value="#{item.dataVencimento}">
                                        <f:convertDateTime locale="#{localeController.localeUI}"
                                                           type="date" timeZone="#{initParam['timezone']}"/>
                                    </h:outputText>
                                </td>
                                <td align='right'>
                                    <h:outputText value="#{item.valor}">
                                        <f:convertNumber locale="#{localeController.localeUI}" type="currency"/> 
                                    </h:outputText>
                                </td>
                                <td align='center'><h:outputText value="#{item.parcelaAtual}"/></td>
                                <td align='center'><h:outputText value="#{item.parcelaTotal}"/></td>
                                <td align='left'><h:outputText value="#{item.observacao}"/></td>
                                <td align='center'><h:outputText value="#{item.detalhe.detalhe}"/></td>
                                <td align='center'><h:outputText value="#{msg[item.statusPagamento]}"/></td>
                                <td align='center'><h:outputText value="#{item.cartaoCredito.cartao}"/></td>
                                <td align='center'><h:outputText value="#{item.usuario.firstName}"/></td>
                                <td><h:commandLink action="#{despesaParceladaController.destroy}" styleClass="ico del" value="#{msg.remover}"
                                                   rendered="#{item.statusPagamento ne 'PAGA'}"
                                                   id="removeLink" onclick="return confirm('#{msg.desejaRemover}: #{item.observacao}?');"/>
                                    <h:outputText value=" "/>
                                    <p:spacer width="15px" height="5px"/>
                                    <h:commandLink styleClass="ico edit" action="#{despesaParceladaController.prepareEdit}" value="#{msg.editar}"
                                                   id="editLink" rendered="#{item.statusPagamento ne 'PAGA'}"/>
                                </td>
                            </tr>
                        </ui:repeat>
                    </tbody>
                </table>
            </h:panelGroup>
            <arq:paginator entityBean="#{despesaParceladaController}"/>
            <p:spacer width="100%" height="20"/>
        </h:form>
        <h:panelGroup id="groupDetalhe" rendered="#{despesaParceladaController.current != null}">
            <ui:include src="form.xhtml"/>
        </h:panelGroup>
    </ui:define>
</ui:composition>

